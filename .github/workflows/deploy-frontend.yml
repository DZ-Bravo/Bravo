name: "ğŸš€ Deploy Frontend Service"

on:
  workflow_dispatch:
    inputs:
      image_tag:
        description: "ì´ë¯¸ì§€ íƒœê·¸ (ì˜ˆ: latest ë˜ëŠ” 1.0)"
        required: true
        default: "latest"

jobs:
  deploy:
    runs-on: self-hosted
    
    env:
      REGISTRY_HOST: "192.168.0.240"
      HARBOR_PROJECT: "mywork"
      SERVICE_NAME: "frontend"     # docker compose ì„œë¹„ìŠ¤ ì´ë¦„
      IMAGE_NAME: "services-frontend"   # Harbor ì´ë¯¸ì§€ ì´ë¦„
      COMPOSE_DIR: "/home/bravo/LABs/services"

    steps:
      - name: ğŸ“Œ ì„ íƒëœ íƒœê·¸ ì¶œë ¥
        run: echo "Deploying ${{ github.event.inputs.image_tag }}"

      - name: ğŸ›‘ ê¸°ì¡´ ì»¨í…Œì´ë„ˆ Pull
        run: |
          IMAGE="${REGISTRY_HOST}/${HARBOR_PROJECT}/${IMAGE_NAME}:${{ github.event.inputs.image_tag }}"
          echo "Pulling $IMAGE"
          docker pull "$IMAGE"

      - name: ğŸ”„ docker-compose ë°°í¬
        run: |
          cd "$COMPOSE_DIR"
          docker compose pull $SERVICE_NAME
          docker compose up -d $SERVICE_NAME

      - name: ğŸ§ª Health Check
        run: |
          sleep 5
          docker ps | grep hiking-frontend && echo "Frontend running" || exit 1
