[SERVICE]
    Flush         1
    Log_Level     info
    Daemon        off
    Parsers_File  parsers.conf

# Docker 컨테이너 로그 수집
[INPUT]
    Name              tail
    Path              /var/lib/docker/containers/*/*-json.log
    Parser            docker
    Tag               docker.*
    Refresh_Interval  5
    Mem_Buf_Limit     50MB
    Skip_Long_Lines   On
    DB                /var/log/flb_kube.db

# 애플리케이션 로그 수집 (백엔드 서비스)
[INPUT]
    Name              tail
    Path              /var/log/app/*.log
    Tag               app.*
    Refresh_Interval  5
    Mem_Buf_Limit     50MB
    Multiline         On
    Parser_Firstline  multiline_log

# 시스템 로그 수집 (선택적)
[INPUT]
    Name              systemd
    Tag               systemd.*
    Systemd_Filter    _SYSTEMD_UNIT=docker.service
    Read_From_Tail    On

# 로그 파싱 및 필터링
[FILTER]
    Name                modify
    Match               docker.*
    Add                 hostname ${HOSTNAME}
    Add                 environment production

# Docker 로그 파싱
[FILTER]
    Name                parser
    Match               docker.*
    Key_Name            log
    Parser              docker
    Reserve_Data        On
    Preserve_Key        On

# 애플리케이션 로그 파싱
[FILTER]
    Name                parser
    Match               app.*
    Key_Name            log
    Parser              json
    Reserve_Data        On

# 로그 레벨 필터링 (ERROR, WARN만 수집하려면 주석 해제)
# [FILTER]
#     Name                grep
#     Match               *
#     Regex               level (ERROR|WARN|INFO)

# Elasticsearch로 로그 전송
[OUTPUT]
    Name                es
    Match               *
    Host                elasticsearch
    Port                9200
    Index               docker-logs
    Logstash_Format     On
    Logstash_Prefix     docker
    Logstash_DateFormat %Y.%m.%d
    Retry_Limit         3
    HTTP_User           elastic
    HTTP_Passwd         ""
    tls                 Off
    tls.verify          Off
    Suppress_Type_Name  On

